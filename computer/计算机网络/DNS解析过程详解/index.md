# DNS解析过程详解

> [原文](http://blog.chinaunix.net/uid-28216282-id-3757849.html)

## 根域

就是所谓的".",其实我们的网址www.baidu.com,在配置中应该是www.baidu.com.(最后有一个点),一般在浏览器输入会省略。

根域服务器具有13个IP地址，但是机器数量不止13台，因为这些IP地址借助了任播的技术。所以可以在全球设立这些IP的镜像站点。这些主机的内容都是一样的


## 域的划分

根域下来就是顶级域或者叫一级域。

有两种划分方式，一种互联网刚兴起时按照行业性质划分的.com,.net等，一种是按国家划分的入.cn,.jp等。

每个域都会有域名服务器，也叫权威域名服务器。

baidu.com就是一个顶级域名，而www.baidu.com却不是顶级域名，他是在baidu.com这个域里的一个叫做www的主机。

一级域之后还有二级域，三级域，只要买了一个顶级域，并且搭建了自己的BIND服务器(或其他软件搭建的)注册到互联网中，那么就可以随意在前面多加几个域了。

比如a.www.baidu.com,在这个网址中，www.baidu.com变成了一个二级域而不是一台主机，主机名是a。

## 域名服务器

能提供域名解析的服务器，上面的记录类型可以是A(address)记录，NS(name server)记录，MX(mail),CNAME等。

A记录就是记录一个IP地址和一个主机名字，比如我这个域名服务器所在的域test.baidu.com,这是一个二级域名，然后在里面有一条A记录，记录了主机为a的IP，查到了就返回给你了。

如果要想baidu.com这个域名服务器查询a.test.baidu.com,那么顶级域名服务器就会发现请求的这个网址在test.baidu.com这个域中，这里记录了二级域名服务器test.baidu.com的NS的IP。我返回给你这个地址你再去查主机为a的主机吧。

这些域内的域名服务器都称为权威服务器，直接提供DNS查询服务。(这些服务器不会做递归)

## 解析过程

1.现在我有一台计算机，通过ISP接入了互联网，那么ISP就会给我分配一个DNS服务器，这个DNS服务器不是权威服务器，而是相当于一个代理的dns解析服务器，他会帮你迭代权威服务器返回的应答，然后把最终查到IP返回给你。

2.现在的我计算机要向这台ISPDNS发起请求查询www.baidu.com这个域名了，(经网友提醒：这里其实准确来说不是ISPDNS，而应该是用户自己电脑网络设置里的DNS，并不一定是ISPDNS。比如也有可能你手工设置了8.8.8.8)

3.ISPDNS拿到请求后，先检查一下自己的缓存中有没有这个地址，有的话就直接返回。这个时候拿到的ip地址，会被标记为非权威服务器的应答。

4.如果缓存中没有的话，ISPDNS会从配置文件里面读取13个根域名服务器的地址（这些地址是不变的，直接在BIND的配置文件中），

5.然后像其中一台发起请求。

6.根服务器拿到这个请求后，知道他是com.这个顶级域名下的，所以就会返回com域中的NS记录，一般来说是13台主机名和IP。

7.然后ISPDNS向其中一台再次发起请求，com域的服务器发现你这请求是baidu.com这个域的，我一查发现了这个域的NS，那我就返回给你，你再去查。

（目前百度有4台baidu.com的顶级域名服务器）。

8.ISPDNS不厌其烦的再次向baidu.com这个域的权威服务器发起请求，baidu.com收到之后，查了下有www的这台主机，就把这个IP返回给你了，

9.然后ISPDNS拿到了之后，将其返回给了客户端，并且把这个保存在高速缓存中。